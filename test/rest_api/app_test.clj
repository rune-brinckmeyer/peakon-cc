(ns rest-api.app-test
  (:require [clojure.test :refer :all]
            [rest-api.app :refer [app-routes]]
            [ring.mock.request :as mock]))


(deftest api-test
  (testing "API Test: Empty request"
    (is (= {:status  200
            :headers {"Content-Type" "application/json"}
            :body    "{\"items\":[],\"items_total\":0,\"page\":1,\"prev_page\":null,\"next_page\":null,\"pages\":1,\"per_page\":5,\"search-term\":null}"}
           (app-routes (mock/request :get "/v1/employee/")))))
  (testing "API Test: Request for 'al' with no options"
    (is (= {:status  200
            :headers {"Content-Type" "application/json"}
            :body    "{\"items\":[{\"type\":\"employees\",\"id\":\"171\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/171\"},\"attributes\":{\"Commute Time\":38,\"Age\":\"1990-02-23\",\"Salary\":238000,\"Last Year Bonus\":277768,\"Department\":\"Security\",\"lastName\":\"Butler\",\"email\":\"donald.butler@kinetar.com\",\"Gender\":\"Male\",\"% of target\":8,\"name\":\"Donald Butler\",\"avatar\":null,\"firstName\":\"Donald\",\"Job Level\":\"Executive\",\"identifier\":null,\"Tenure\":\"2013-04-12\",\"features\":[\"engagement\"],\"Business Unit\":\"IT\",\"employmentStart\":\"2016-01-31T00:00:00.000Z\",\"Region\":\"EMEA\",\"Local Office\":\"Berlin\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"172\"}},\"phones\":{\"data\":[]},\"Manager\":{\"data\":{\"type\":\"employees\",\"id\":\"139\"}}}},{\"type\":\"employees\",\"id\":\"141\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/141\"},\"attributes\":{\"Commute Time\":67,\"Age\":\"1988-07-04\",\"Salary\":441000,\"Last Year Bonus\":137145,\"Department\":\"Recruitment\",\"lastName\":\"Maxwell\",\"email\":\"alta.maxwell@kinetar.com\",\"Gender\":\"Female\",\"% of target\":21,\"name\":\"Alta Maxwell\",\"avatar\":null,\"firstName\":\"Alta\",\"Job Level\":\"Executive\",\"identifier\":null,\"Tenure\":\"2016-04-17\",\"features\":[\"engagement\"],\"Business Unit\":\"People & Operations\",\"employmentStart\":\"2016-01-31T00:00:00.000Z\",\"Region\":\"APAC\",\"Local Office\":\"Tokyo\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"142\"}},\"phones\":{\"data\":[]},\"Manager\":{\"data\":{\"type\":\"employees\",\"id\":\"139\"}}}}],\"items_total\":2,\"page\":1,\"prev_page\":null,\"next_page\":null,\"pages\":1,\"per_page\":5,\"search-term\":\"al\"}"}
           (app-routes (mock/request :get "/v1/employee/al")))))
  (testing "API Test: Propagate query parameters"
    (is (= {:status  200
            :headers {"Content-Type" "application/json"}
            :body    "{\"items\":[{\"type\":\"employees\",\"id\":\"323\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/323\"},\"attributes\":{\"Commute Time\":34,\"Age\":\"1984-02-08\",\"Salary\":76000,\"Last Year Bonus\":3767,\"Department\":\"Customer Care\",\"lastName\":\"McKinney\",\"email\":\"harriet.mckinney@kinetar.com\",\"Gender\":\"Female\",\"% of target\":88,\"name\":\"Harriet McKinney\",\"avatar\":null,\"firstName\":\"Harriet\",\"Job Level\":\"Manager\",\"identifier\":null,\"Tenure\":\"2014-05-31\",\"features\":[\"engagement\"],\"Business Unit\":\"Sales\",\"employmentStart\":\"2016-01-31T00:00:00.000Z\",\"Region\":\"APAC\",\"Local Office\":\"Kuala Lumpur\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"324\"}},\"phones\":{\"data\":[]},\"Manager\":{\"data\":{\"type\":\"employees\",\"id\":\"201\"}}}},{\"type\":\"employees\",\"id\":\"139\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/139\"},\"attributes\":{\"Commute Time\":18,\"Age\":\"1984-04-19\",\"Salary\":332000,\"Last Year Bonus\":215835,\"Department\":\"Learning and Development\",\"lastName\":\"Banks\",\"email\":\"harriet.banks@kinetar.com\",\"Gender\":\"Female\",\"% of target\":12,\"name\":\"Harriet Banks\",\"avatar\":null,\"firstName\":\"Harriet\",\"Job Level\":\"Executive\",\"identifier\":null,\"Tenure\":\"2009-06-30\",\"features\":[\"engagement\"],\"Business Unit\":\"People & Operations\",\"employmentStart\":\"2016-01-31T00:00:00.000Z\",\"Region\":\"AMER\",\"Local Office\":\"New York\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"140\"}},\"phones\":{\"data\":[]}}},{\"type\":\"employees\",\"id\":\"142\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/142\"},\"attributes\":{\"Commute Time\":131,\"Age\":\"1976-12-19\",\"Salary\":248000,\"Last Year Bonus\":95050,\"Department\":\"Media\",\"lastName\":\"Summers\",\"email\":\"mathilda.summers@kinetar.com\",\"Gender\":\"Female\",\"% of target\":166,\"name\":\"Mathilda Summers\",\"avatar\":null,\"firstName\":\"Mathilda\",\"Job Level\":\"Executive\",\"identifier\":null,\"Tenure\":\"2000-05-15\",\"features\":[\"engagement\"],\"Business Unit\":\"Marketing\",\"employmentStart\":\"2016-01-31T00:00:00.000Z\",\"Region\":\"EMEA\",\"Local Office\":\"London\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"143\"}},\"phones\":{\"data\":[]},\"Manager\":{\"data\":{\"type\":\"employees\",\"id\":\"139\"}}}},{\"type\":\"employees\",\"id\":\"140\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/140\"},\"attributes\":{\"Commute Time\":16,\"Age\":\"1980-03-21\",\"Salary\":483000,\"Last Year Bonus\":157643,\"Department\":\"Engineering\",\"lastName\":\"Wong\",\"email\":\"eugene.wong@kinetar.com\",\"Gender\":\"Male\",\"% of target\":180,\"name\":\"Eugene Wong\",\"avatar\":null,\"firstName\":\"Eugene\",\"Job Level\":\"Executive\",\"identifier\":null,\"Tenure\":\"2011-01-31\",\"features\":[\"engagement\"],\"Business Unit\":\"Technology\",\"employmentStart\":\"2016-01-31T00:00:00.000Z\",\"Region\":\"AMER\",\"Local Office\":\"New York\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"141\"}},\"phones\":{\"data\":[]},\"Manager\":{\"data\":{\"type\":\"employees\",\"id\":\"139\"}}}},{\"type\":\"employees\",\"id\":\"340\",\"links\":{\"self\":\"http:\\/\\/localhost:3000\\/v1\\/employees\\/340\"},\"attributes\":{\"lastName\":\"Manager\",\"email\":\"manager@kinetar.com\",\"name\":\"New Manager\",\"avatar\":null,\"firstName\":\"New\",\"identifier\":null,\"features\":[\"engagement\"],\"employmentStart\":\"2018-02-23T09:09:44.447Z\",\"external\":false},\"relationships\":{\"company\":{\"data\":{\"type\":\"companies\",\"id\":\"5\"}},\"account\":{\"data\":{\"type\":\"accounts\",\"id\":\"341\"}},\"phones\":{\"data\":[]},\"Manager\":{\"data\":{\"type\":\"employees\",\"id\":\"139\"}}}}],\"items_total\":9,\"page\":1,\"prev_page\":null,\"next_page\":2,\"pages\":2,\"per_page\":5,\"search-term\":\"@\"}"}
           (app-routes (mock/request :get "/v1/employee/@?page=2&per_page=3")))))

  )
